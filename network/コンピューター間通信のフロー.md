# コンピューター間通信のフロー

## フローの全体像
1. ソケット作成
2. コネクションの確立
3. データ送受信
4. コネクションの破棄

## ソケット作成
browserなどのアプリケーションがSocketライブラリ経由でOSのプロトコルスタックにソケット作成を依頼する。
ソケットとは、プロトコルスタック内のメモリ領域のことを指し、通信に必要な制御情報（クライアントのIP、サーバーのIP、クライアント-サーバー間の通信状態（未接続なのか、接続済みなのか、など）、通信しようとしているプロセスのIDなど）が記録される。
ソケット作成とは、プロトコルスタックがこのメモリ領域を確保することを指す。
ソケット作成後は、アプリケーションに制御が戻る。

## コネクションの確立
アプリケーションがSocketライブラリのconnect()関数を呼び出すと、プロトコルスタックがコネクション確立を開始する。
アプリケーションはプロトコルスタックに、接続先のIPアドレスを渡す。
プロトコルスタックはサーバーに対し、接続元/接続先のIP・ポート番号を含むパケットを送信する。
サーバーはパケットを受領し接続処理を行った上で、「パケットを受領したこと」を示す情報を含むパケットをクライアントに送信する。
クライアントはパケットを受領し、ソケットに接続先IP・ポートを記録した上で、「パケットを受領したこと」を示す情報を含むパケットをサーバーに送信し、アプリケーションに制御が戻る。
サーバーはパケットを受領し、コネクションの確立が完了する。

↑これが「3wayhandshake」と言われる手順？

## データの送受信
アプリケーションはSocketライブラリのwrite(descriptor, request-message)を呼び出し、プロトコルスタックにデータの送受信を依頼する。
プロトコルスタックが一度に送信できるデータ量は決まっている（maximum transfer unit, maximum segment size）。
データ送信効率を高めるために、MSSギリギリになるまでアプリケーションからの送信依頼を溜め、一回の送信でなるべく多くのデータを送信しようとする。
しかし、MSSギリギリまでデータ送信を待つと、アプリケーションからの送信依頼から実際の送信までにタイムラグが生じる。そのため待ち時間の限度もプロトコルスタックで決まっている。
